<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard with Supabase</title>
  <style>
/* ---------- GLOBAL ---------- */
body {
  background: #12181f;
  color: #e6e9eb;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  min-height: 100vh;
}

/* ---------- NAVBAR ---------- */
.navbar {
  display: none; /* hidden until login */
  justify-content: space-between;
  align-items: center;
  background: rgba(22, 30, 40, 0.9);
  backdrop-filter: blur(12px);
  padding: 14px 32px;
  box-shadow: 0 4px 18px rgba(0, 0, 0, 0.6);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.navbar-title {
  font-size: 1.4rem;
  font-weight: 700;
  color: #6ee3a4;
  text-shadow: 0 1px 5px rgba(16, 68, 42, 0.75);
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 20px;
  margin: 0;
  padding: 0;
}

.nav-links li {
  cursor: pointer;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 600;
  transition: all 0.25s ease;
}

.nav-links li:hover {
  background: rgba(110, 227, 164, 0.15);
  transform: translateY(-2px);
}

.nav-links li.active {
  background: rgba(110, 227, 164, 0.25);
  color: #6ee3a4;
  box-shadow: 0 0 10px rgba(110, 227, 164, 0.4);
}

/* ---------- LOGIN CARD ---------- */
.card {
  background: linear-gradient(145deg, #1f2b33, #151c23);
  border-radius: 16px;
  box-shadow: 0 6px 22px rgba(0, 0, 0, 0.55);
  padding: 40px 36px;
  max-width: 380px;
  margin: 100px auto;
  text-align: center;
  transition: transform 0.3s, box-shadow 0.3s;
}

.card:hover {
  box-shadow: 0 12px 32px rgba(44, 174, 120, 0.7);
  transform: translateY(-6px);
}

h2 {
  margin-bottom: 24px;
  font-weight: 700;
  color: #6ee3a4;
  letter-spacing: 1.2px;
  text-shadow: 0 1px 5px rgba(16, 68, 42, 0.75);
}

/* ---------- FORM INPUTS ---------- */
input {
  width: 100%;
  padding: 14px;
  margin: 12px 0;
  border-radius: 10px;
  border: none;
  background: #1b2631;
  color: #d1e6d6;
  font-size: 1rem;
  box-shadow: inset 0 0 8px #0c1a0d66;
  transition: all 0.25s;
}

input:focus {
  outline: none;
  background: #273645;
  box-shadow: 0 0 12px #6be596;
  color: #effdf4;
}

/* ---------- BUTTON ---------- */
.btn {
  width: 100%;
  background: #44b175;
  border: none;
  border-radius: 12px;
  padding: 14px 22px;
  color: #fff;
  font-weight: 700;
  font-size: 1.1rem;
  cursor: pointer;
  margin-top: 16px;
  box-shadow: 0 6px 20px rgba(68, 177, 117, 0.45);
  transition: all 0.3s ease;
}

.btn:hover {
  background: #36a159;
  box-shadow: 0 10px 28px rgba(54, 161, 89, 0.65);
  transform: translateY(-2px);
}

/* ---------- DASHBOARD SECTIONS ---------- */
.dashboard-section {
  display: none; /* default hidden */
}

.dashboard-section.active {
  display: block; /* only active one shows */
}

.area {
  background: linear-gradient(145deg, #1c262c, #14181f);
  border-radius: 18px;
  padding: 28px;
  max-width: 900px;
  margin: 40px auto;
  box-shadow: inset 0 0 20px rgba(107, 229, 150, 0.15);
  color: #a5c9b1;
}

.details {
  background: #202a33;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  font-family: monospace;
  font-weight: 600;
  color: #c2dec4;
}

/* ---------- TABLE ---------- */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 16px;
  background: rgba(30, 40, 50, 0.8);
  border-radius: 12px;
  overflow: hidden;
}

thead {
  background: #233138;
  color: #6ee3a4;
}

th, td {
  padding: 12px 16px;
  text-align: left;
}

tbody tr:hover {
  background: rgba(110, 227, 164, 0.08);
  transition: 0.25s ease;
}

/* ---------- ERROR MESSAGE ---------- */
#login-error {
  color: #ff6b6b;
  margin-top: 10px;
  min-height: 24px;
  font-weight: 700;
  text-align: center;
}

.hidden {
  display: none !important;
}

  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>
   <link rel="stylesheet" href="style.css" />
  <script>
function fromBase64(base64) {
  // Replace URL-safe characters to standard base64 characters (if any)
  base64 = base64.replace(/-/g, '+').replace(/_/g, '/');
  // Pad string length to multiple of 4
  while (base64.length % 4 !== 0) {
    base64 += '=';
  }
  return atob(base64);
}

const SUPABASE_URL = fromBase64(window.SUPABASE_URL_B64);
const SUPABASE_ANON_KEY = fromBase64(window.SUPABASE_ANON_KEY_B64);

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function adminLogin() {
      document.getElementById("main-navbar").style.display = "flex";

  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  const err = document.getElementById("login-error");
  err.textContent = "";

  if (!u || !p) {
    err.textContent = "Please enter username and password.";
    return;
  }

  // Hardcoded admin login bypass
  if (u.toLowerCase() === "admin" && p === "Admin@123") {
    // Successful admin login without DB check

    document.getElementById("login-section").classList.add("hidden");
    document.getElementById("dashboard-section").classList.remove("hidden");
    document.getElementById("main-navbar").style.display = "flex";


    // You can optionally load users and other dashboard data
    await loadUsers();
    await loadContacts();
    return; // Exit early to skip DB query
  }

  try {
    // Continue with normal database check for other users, if any
    const { data: users, error } = await supabaseClient
      .from('app_users')
      .select('*')
      .eq('name', u)
      .eq('password', p)
      .limit(1);

    if (error) {
      err.textContent = "Error authenticating: " + error.message;
      return;
    }
    if (!users || users.length === 0) {
      err.textContent = "Invalid username or password.";
      return;
    }

    // Successful login via DB
    document.getElementById("login-section").classList.add("hidden");
    document.getElementById("dashboard-section").classList.remove("hidden");
  
    await loadUsers();
    await loadContacts();
  }
  catch (ex) {
    err.textContent = "Unexpected error: " + ex.message;
  }
}

    function adminLogout() {
      document.getElementById("login-section").classList.remove("hidden");
      document.getElementById("dashboard-section").classList.add("hidden");
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
      document.getElementById("login-error").textContent = "";
       document.getElementById("main-navbar").style.display = "none";
    }

    async function loadUsers() {
      const usersDiv = document.getElementById("users-list");
      usersDiv.textContent = "Loading...";

      const { data: users, error } = await supabaseClient
        .from('login_history')
        .select('*')
        .order('time', { ascending: false });

      if (error) {
        usersDiv.textContent = "Failed to load users: " + error.message;
        return;
      }
      if (!users || users.length === 0) {
        usersDiv.textContent = "No users have logged in.";
        return;
      }
      usersDiv.innerHTML = users.map(
        (u, i) => `<div class="details"><b>#${i+1}</b> ${escapeHtml(u.name)} (${escapeHtml(u.email)})<br><small>${formatDate(u.time)}</small></div>`
      ).join('');
    }

    async function loadContacts() {
      const contactsDiv = document.getElementById("contacts-list");
      contactsDiv.textContent = "Loading...";

      const { data: contacts, error } = await supabaseClient
        .from('contact_messages')
        .select('*')
        .order('submitted_at', { ascending: false });

      if (error) {
        contactsDiv.textContent = "Failed to load contacts: " + error.message;
        return;
      }
      if (!contacts || contacts.length === 0) {
        contactsDiv.textContent = "No contact form submissions.";
        return;
      }
      contactsDiv.innerHTML = contacts.map(
        (c, i) => `<div class="details"><b>#${i+1}</b> ${escapeHtml(c.name)} (${escapeHtml(c.email)})<br><small>${formatDate(c.submitted_at)}</small><br>Message: ${escapeHtml(c.message)}</div>`
      ).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function formatDate(val) {
      try {
        if (!val) return "";
        return new Date(val).toLocaleString();
      } catch {
        return val;
      }
    }
  async function loadContactSubmissions() {
  const { data, error } = await supabaseClient
    .from('form_submissions')
    .select('id, name, email, message, submitted_at')
    .order('submitted_at', { ascending: false });

  if (error) {
    document.getElementById('contactSubmissionsSection').innerHTML =
      "<p>Failed to load contacts: " + error.message + "</p>";
    return;
  }

  // Render table rows
  const rows = data.map(
    sub => `
      <tr>
        <td>${sub.name}</td>
        <td>${sub.email}</td>
        <td>${sub.message}</td>
        <td>${new Date(sub.submitted_at).toLocaleString()}</td>
      </tr>
    `
  ).join('');

  document.getElementById('contactSubmissionsTableBody').innerHTML = rows;
}
async function loadRegisteredUsers() {
  const { data, error } = await supabaseClient
    .from('app_users')
    .select('name, email, role')
    .order('id', { ascending: false });

  const tbody = document.getElementById('usersTableBody');

  if (error) {
    tbody.innerHTML = `<tr><td colspan="3">Failed to load users: ${error.message}</td></tr>`;
    return;
  }

  if (!data || data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="3">No registered users found.</td></tr>`;
    return;
  }

  tbody.innerHTML = data.map(
    user => `<tr>
      <td>${user.name}</td>
      <td>${user.email}</td>
      <td>${user.role}</td>
    </tr>`
  ).join('');
}

document.addEventListener('DOMContentLoaded', loadRegisteredUsers);

 function showSection(sectionId) {
  // Hide all dashboard sections
  document.querySelectorAll('.dashboard-section').forEach(
    d => d.classList.remove('active')
  );
  // Remove active from all nav links
  document.querySelectorAll('.nav-links li').forEach(
    l => l.classList.remove('active')
  );

  // Show the clicked section and highlight nav
  document.getElementById(sectionId).classList.add('active');
  let navIndex = 0;
  if (sectionId === 'contactForms') navIndex = 1;
  else if (sectionId === 'registeredUsers') navIndex = 2;
  document.querySelectorAll('.nav-links li')[navIndex].classList.add('active');
}


  </script>

</head>
<body>
  <body>
  <nav class="navbar" id="main-navbar" style="display: none;">
    <span class="navbar-title">Admin Panel</span>
    <ul class="nav-links">
      <li class="active" onclick="showSection('usersLoggedIn')">Users Logged In</li>
      <li onclick="showSection('contactForms')">Contact Form Submissions</li>
      <li onclick="showSection('registeredUsers')">Registered Users</li>
      <li onclick="adminLogout()" style="margin-left:30px;">Logout</li>
    </ul>
  </nav>

  <div class="card" id="login-section">
    <h2>Admin Login</h2>
    <input type="text" id="username" placeholder="Username" autocomplete="username" />
    <input type="password" id="password" placeholder="Password" autocomplete="current-password" />
    <div id="login-error"></div>
    <button class="btn" onclick="adminLogin()">Login</button>
  </div>
  
  <div id="dashboard-section" class="hidden">
    <div id="usersLoggedIn" class="dashboard-section active area">
      <h2>Users Logged In</h2>
      <div id="users-list">Loading...</div>
    </div>
    <div id="contactForms" class="dashboard-section area">
      <h2>Contact Form Submissions</h2>
      <div id="contacts-list">Loading...</div>
    </div>
    <div id="registeredUsers" class="dashboard-section area">
      <h2>Registered Users</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
          </tr>
        </thead>
        <tbody id="usersTableBody"></tbody>
      </table>
    </div>
  </div>
</body>



</body>
</html>
